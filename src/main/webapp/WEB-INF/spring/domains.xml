<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd
                http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
                http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.1.xsd"
 >

    <context:annotation-config/>



    <!--
        START OF DOMAIN DEFINITIONS
    -->

    <bean id="LdapDomain" class="org.jasig.portlet.contacts.domains.impl.GenericContactDomain">
        <property name="searchAdapter" ref="LdapSearch"/>
        <property name="name" value="Online Directory"/>
    </bean>


    <!--
       END OF DOMAIN DEFINITIONS
    -->






    <!--
        START OF ADAPTER DEFINITIONS
    -->
    
    <bean id="LdapContactMapper" class="org.jasig.portlet.contacts.adapters.impl.ldap.ConfigurableContactAttributesMapper">
        <constructor-arg>
            <map>
                <entry key="id" value=""/>
                <entry key="contactSource" value=""/>
                <entry key="department" value=""/>
                <entry key="firstname" value=""/>
                <entry key="initials" value=""/>
                <entry key="organisation" value=""/>
                <entry key="position" value=""/>
                <entry key="surname" value=""/>
                <entry key="title" value=""/>
                <entry key="imageURI" value=""/>
                <entry key="phone">
                    <map>
                        <entry key="label" value=""/>
                        <entry key="type" value=""/>
                        <entry key="phoneNumber" value=""/>
                    </map>
                </entry>
                <entry key="email">
                    <map>
                        <entry key="label" value=""/>
                        <entry key="type" value=""/>
                        <entry key="emailAddress" value=""/>
                    </map>
                </entry>
                <entry key="address">
                    <map>
                        <entry key="label" value=""/>
                        <entry key="type" value=""/>
                        <entry key="internal" value=""/>
                        <entry key="building" value=""/>
                        <entry key="street" value=""/>
                        <entry key="locality" value=""/>
                        <entry key="region" value=""/>
                        <entry key="postCode" value=""/>
                        <entry key="Country" value=""/>
                    </map>
                </entry>
            </map>
        </constructor-arg>
    </bean>

    <bean id="searchLdapTemplate" class="org.springframework.ldap.core.LdapTemplate">
            <property name="contextSource" ref="searchDirLdapContext"/>
    </bean>

    <bean id="searchDirLdapContext" class="org.springframework.ldap.core.support.LdapContextSource">
            <property name="url" value="${search.ldap.url}"/>
            <property name="base" value="${search.ldap.base}"/>
            <property name="pooled" value="false"/>
    </bean>

    <bean id="LdapSearch" class="org.jasig.portlet.contacts.adapters.impl.ldap.LdapSearchAdapter">
        <constructor-arg ref="searchLdapTemplate"/> 
        <property name="filters">
            <map>
                <entry key="Staff">
                    <list>
                        <value>Staff</value>
                    </list>       
                </entry>
                <entry key="Students">
                    <list>
                        <value>Undergraduate</value>
                        <value>Postgraduate</value>
                    </list>       
                </entry>
                <entry key="All">
                    <list/>           
                </entry>
            </map>
        </property>  
        <property name="timeLimit" value="5000"/>
        <property name="context" ref="context"/>
        <property name="contactMapper" ref="UoMLdapContactMapper"/>
    </bean>
    

    <!--
        END OF ADAPTER DEFINITIONS
    -->

</beans>